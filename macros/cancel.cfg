[gcode_macro CANCEL_PRINT]
description: Cancel the actual running print
rename_existing: CANCEL_PRINT_BASE
gcode:
  STATUS_BUSY # set LEDs
  SET_TEMPERATURE_FAN_TARGET temperature_fan=chamber TARGET=30 # cool down chamber
  M106 S0 # Turn off fan
  G91 # Relative positioning
  G1 E-15 F500 # retract out of hot zone
  G1 Z50 # move bed out of the way
  G90 # Absolute positioning
  TURN_OFF_HEATERS
  M84 # Disable all steppers
  SET_TEMPERATURE_FAN_TARGET temperature_fan=electronics_fan TARGET=60 # set target electronics temp higher than during print (effectively turns it off, so it's not trying to spin at <10% forever)
  BED_MESH_CLEAR
  CANCEL_PRINT_BASE
  M117 # clear display
  STATUS_READY # set LEDs
  RUN_SHELL_COMMAND CMD=print_done
